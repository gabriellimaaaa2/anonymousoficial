<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AnonymousApp</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="dashboard-header">
            <div class="user-info">
                <h1>ğŸ­ OlÃ¡, <span id="username">UsuÃ¡rio</span>!</h1>
                <p>Suas mensagens anÃ´nimas</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="copyLink()">ğŸ“‹ Copiar Link</button>
                <button class="btn btn-outline" onclick="logout()">ğŸšª Sair</button>
            </div>
        </header>

        <div class="dashboard-content">
            <!-- Link personalizado -->
            <div class="link-section">
                <h3>Seu Link Personalizado</h3>
                <div class="link-box">
                    <input type="text" id="personalLink" readonly 
                           value="Carregando..." 
                           onclick="this.select()">
                    <button class="btn btn-primary" onclick="copyLink()">Copiar</button>
                </div>
                <p>Compartilhe este link para receber mensagens anÃ´nimas!</p>
            </div>

            <!-- ConfiguraÃ§Ã£o BSPay (apenas para admin) -->
            <div class="admin-section" id="adminSection" style="display: none;">
                <h3>âš™ï¸ ConfiguraÃ§Ã£o BSPay (Admin)</h3>
                <div class="bspay-config">
                    <div class="form-group">
                        <label>Client ID:</label>
                        <input type="text" id="bspayClientId" value="Gabriellima02_8489541538893349" readonly>
                    </div>
                    <div class="form-group">
                        <label>Client Secret:</label>
                        <input type="password" id="bspaySecret" value="3e6dbd4930f68f1e3d2b434017419ab49ee4a8aff0ecc24777459d8c91549144" readonly>
                    </div>
                    <button class="btn btn-primary" onclick="testBSPay()">Testar ConexÃ£o</button>
                </div>
            </div>

            <!-- Mensagens recebidas -->
            <div class="messages-section">
                <h3>ğŸ“¬ Mensagens Recebidas</h3>
                <div id="messagesContainer" class="messages-container">
                    <!-- Mensagens serÃ£o carregadas aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Pistas -->
    <div id="pistasModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ” Pista da Mensagem</h3>
                <button class="close-btn" onclick="closePistasModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="pista-content">
                    <p id="pistaText">Esta pessoa provavelmente te conhece do trabalho...</p>
                </div>
                <div class="disclaimer">
                    <p><strong>âš ï¸ Disclaimer:</strong> As pistas sÃ£o baseadas em anÃ¡lise de padrÃµes e podem nÃ£o ser 100% precisas.</p>
                </div>
                <div class="payment-options">
                    <h4>ğŸ’³ Desbloquear Pista - R$ 2,99</h4>
                    <button class="btn btn-primary" id="pixButton">PIX</button>
                    <button class="btn btn-secondary" id="cardButton">CartÃ£o</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup de notificaÃ§Ãµes -->
    <div id="popup" class="popup hidden">
        <div class="popup-content">
            <h3 id="popup-title">NotificaÃ§Ã£o</h3>
            <p id="popup-message">Mensagem</p>
            <button class="btn btn-primary" onclick="closePopup()">OK</button>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="messages.js"></script>
    <script src="payment.js"></script>
    <script src="pistas.js"></script>

    <script>
        let currentMessageId = null;

        // Abrir modal de pista com ID da mensagem
        function openPistasModal(messageId, pistaText) {
            currentMessageId = messageId;
            document.getElementById('pistaText').innerText = pistaText;
            document.getElementById('pistasModal').classList.remove('hidden');
        }

        function closePistasModal() {
            document.getElementById('pistasModal').classList.add('hidden');
        }

        // Conecta os botÃµes PIX e CartÃ£o ao PaymentSystem
        document.getElementById('pixButton').addEventListener('click', () => {
            if (!currentMessageId) return alert('Erro: ID da mensagem nÃ£o encontrado.');
            PaymentSystem.openPixForMessage({
                messageId: currentMessageId,
                amount: 2.99
            });
        });

        document.getElementById('cardButton').addEventListener('click', () => {
            if (!currentMessageId) return alert('Erro: ID da mensagem nÃ£o encontrado.');
            PaymentSystem.openCardForMessage({
                messageId: currentMessageId,
                amount: 2.99
            });
        });
    </script>
</body>
</html>
